# Description

These files are from troubleshooting a customer issue where programmatic authentication using the OIDC authentication method was failing. 

#### The function I used to reproduce this was as follows
```
func oidcTokenFromVault(vaultClient *vault.Client) (string, error) {
// Perform the OIDC login
secret, err := vaultClient.Logical().Write("auth/oidc/login", map[string]interface{}{})
if err != nil {
return "", err
}
```

#### Subsequent error
```
$ go run oidcTest.go                                                                                                                                                                                            
2023/08/01 18:48:38 unable to obtain OIDC token: Error making API request.

URL: PUT http://127.0.0.1:8200/v1/auth/oidc/login
Code: 400. Errors:

* role with oidc role_type is not allowed
exit status 1
```

### Files

- `oidcTest.go` - The dummy Go script used. Tested with a basic token to auth, and it worked. Then replaced the token value with the OIDC function and its output value to replicate the customer issue.

- `cli-success.json` - Audit log entries tracking the API call made to Vault and its subsequent response from a successful CLI authentication attempt to the endpoint

- `golang-failed.json` - The same audit log entry for the API call generated by the script

- `missing-data.json` - Cross-referencing both API calls found that much of the data was incorrect, noted these down in this file.

### Reproduction details and results

Compaping an OIDC auth success via the command line (which is essentially just a wrapper around the API) with a failed attempt by the Golang script highlighted key differences in the requests being made.

Ultimately the `path` being used by the customer was incorrect.

After changing the `secret` variable in the `oidcTokenFromVault()` function to point towards `auth/oidc/oidc/auth_url` the error resolved:

```
secret, err := vaultClient.Logical().Write("auth/oidc/oidc/auth_url", map[string]interface{}{})
```

This resulted in a new error:

```
$ go run oidcTest.go

2023/08/02 13:16:52 unable to obtain OIDC token: Error making API request.

URL: PUT http://127.0.0.1:8200/v1/auth/oidc/oidc/auth_url
Code: 400. Errors:

* missing redirect_uri
exit status 1
```

Further code modifications were required to add the missing parameters to the function to pass to Vault. 

### Outcome

Ultimately, Vault's OIDC authentication requires access to a browser - headless OIDC auth is not supported as far as I am aware. 

I recommended the customer could experiment with implementing a [solution similar to the ones found here](https://stackoverflow.com/questions/39320371/how-start-web-server-to-open-page-in-browser-in-golang) and passing the required values to the browser, or alternatively look at whether [Golang's own browser package](https://pkg.go.dev/github.com/pkg/browser), though it seems fairly limited and without further testing I'm not entirely sure of the feasibility of either of those as valid solutions.